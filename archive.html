---
layout: default
title: Archive
permalink: /archive/
pagination:
  enabled: true
  per_page: 25
---

<div class="archive-container">
  <div class="archive-header">
    <h1 class="archive-heading">Everything we've written thus far...</h1>
  </div>

  <!-- Search Bar -->
  <section class="archive-search">
    <div class="search-container">
      <div class="search-wrapper">
        <div class="search-input-group">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z" />
          </svg>
          <div class="search-input-wrapper">
            <input
              type="text"
              id="archive-search"
              placeholder=""
              autocomplete="off"
              role="combobox"
              aria-autocomplete="list"
              aria-controls="search-suggestions"
              aria-expanded="false"
            >
            <span class="search-placeholder" id="search-placeholder">Loading...</span>
          </div>
        </div>
      </div>
      <!-- Suggestions dropdown -->
      <div class="search-suggestions" id="search-suggestions" role="listbox" aria-label="Article suggestions">
        <!-- Results populated by JS -->
      </div>
    </div>
  </section>

  <!-- Article List -->
  <ul class="archive-list">
    {% for post in paginator.posts %}
    <li class="archive-item">
      <a href="{{ post.url | relative_url }}">
        <div class="archive-date">{{ post.date | date: "%-d %B %Y" }}</div>
        <h2 class="archive-title">{{ post.title }}</h2>
        <p class="archive-excerpt">{{ post.description | default: post.excerpt | strip_html | truncate: 160 }}</p>
      </a>
    </li>
    {% endfor %}
  </ul>

  {% if paginator.total_pages > 1 %}
  <nav class="archive-pagination">
    {% if paginator.previous_page %}
      <a href="{{ paginator.previous_page_path | relative_url }}" class="pagination-link">&larr; Newer</a>
    {% else %}
      <span class="pagination-link disabled">&larr; Newer</span>
    {% endif %}
    <div class="pagination-numbers">
      {% for page in (1..paginator.total_pages) %}
        {% if page == paginator.page %}
          <span class="pagination-number active">{{ page }}</span>
        {% else %}
          <a href="{% if page == 1 %}{{ '/archive/' | relative_url }}{% else %}{{ '/archive/page/' | append: page | append: '/' | relative_url }}{% endif %}" class="pagination-number">{{ page }}</a>
        {% endif %}
      {% endfor %}
    </div>
    {% if paginator.next_page %}
      <a href="{{ paginator.next_page_path | relative_url }}" class="pagination-link">Older &rarr;</a>
    {% else %}
      <span class="pagination-link disabled">Older &rarr;</span>
    {% endif %}
  </nav>
  {% endif %}

  <p class="archive-subtext">...with more to come.</p>

</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const searchInput = document.getElementById('archive-search');
  const searchPlaceholder = document.getElementById('search-placeholder');
  const suggestions = document.getElementById('search-suggestions');
  let allPosts = [];
  let placeholderInterval = null;
  let selectedIndex = -1;

  // Placeholder prompts
  const prompts = [
    'Search the archive',
    'the Western Balkans',
    'essays on culture',
    'a slower take',
    'Ljubljana'
  ];
  let currentPromptIndex = 0;

  // Cycle through placeholders with slide + blur
  function cyclePlaceholder() {
    if (searchInput.value) return;

    searchPlaceholder.classList.add('slide-out');

    setTimeout(() => {
      currentPromptIndex = (currentPromptIndex + 1) % prompts.length;
      searchPlaceholder.textContent = prompts[currentPromptIndex];
      searchPlaceholder.classList.remove('slide-out');
      searchPlaceholder.classList.add('slide-in');

      requestAnimationFrame(() => {
        requestAnimationFrame(() => {
          searchPlaceholder.classList.remove('slide-in');
        });
      });
    }, 400);
  }

  function startPlaceholderCycle() {
    if (placeholderInterval) return;
    placeholderInterval = setInterval(cyclePlaceholder, 3000);
  }

  function stopPlaceholderCycle() {
    if (placeholderInterval) {
      clearInterval(placeholderInterval);
      placeholderInterval = null;
    }
  }

  function showSuggestions(results) {
    if (results.length === 0) {
      suggestions.innerHTML = '<div class="search-suggestion-item no-results">No articles found</div>';
    } else {
      suggestions.innerHTML = results.map((post, index) => `
        <a href="${post.url}" class="search-suggestion-item" role="option" data-index="${index}">
          <span class="suggestion-title">${post.title}</span>
          <span class="suggestion-date">${post.date}</span>
        </a>
      `).join('');
    }
    suggestions.classList.add('is-open');
    searchInput.setAttribute('aria-expanded', 'true');
    selectedIndex = -1;
  }

  function hideSuggestions() {
    suggestions.classList.remove('is-open');
    searchInput.setAttribute('aria-expanded', 'false');
    selectedIndex = -1;
  }

  function updateSelection(newIndex) {
    const items = suggestions.querySelectorAll('.search-suggestion-item:not(.no-results)');
    if (items.length === 0) return;

    // Wrap around
    if (newIndex < 0) newIndex = items.length - 1;
    if (newIndex >= items.length) newIndex = 0;

    // Remove previous selection
    items.forEach(item => item.classList.remove('is-selected'));

    // Add new selection
    selectedIndex = newIndex;
    items[selectedIndex].classList.add('is-selected');
    items[selectedIndex].scrollIntoView({ block: 'nearest' });
  }

  // Disable input until index loads
  searchInput.disabled = true;
  searchPlaceholder.textContent = 'Loading...';

  // Fetch all posts for search
  fetch('{{ "/search.json" | relative_url }}')
    .then(response => response.json())
    .then(data => {
      allPosts = data;
      searchInput.disabled = false;
      searchPlaceholder.textContent = prompts[0];
      startPlaceholderCycle();
    })
    .catch(err => {
      console.error('Search index failed to load:', err);
      searchPlaceholder.textContent = 'Search unavailable';
    });

  // Hide placeholder on focus
  searchInput.addEventListener('focus', function() {
    searchPlaceholder.classList.add('hidden');
    stopPlaceholderCycle();
  });

  // Handle blur with delay for click events
  searchInput.addEventListener('blur', function() {
    setTimeout(() => {
      hideSuggestions();
      this.value = '';
      searchPlaceholder.classList.remove('hidden');
      currentPromptIndex = 0;
      searchPlaceholder.textContent = prompts[0];
      startPlaceholderCycle();
    }, 150);
  });

  // Filter and show suggestions on input
  searchInput.addEventListener('input', function() {
    const query = this.value.toLowerCase().trim();

    if (query === '') {
      hideSuggestions();
      return;
    }

    const results = allPosts.filter(post => {
      const searchText = `${post.title} ${post.description} ${post.category} ${post.category_display}`.toLowerCase();
      return searchText.includes(query);
    });

    showSuggestions(results);
  });

  // Keyboard navigation
  searchInput.addEventListener('keydown', function(e) {
    const items = suggestions.querySelectorAll('.search-suggestion-item:not(.no-results)');

    if (e.key === 'ArrowDown') {
      e.preventDefault();
      updateSelection(selectedIndex + 1);
    } else if (e.key === 'ArrowUp') {
      e.preventDefault();
      updateSelection(selectedIndex - 1);
    } else if (e.key === 'Enter' && selectedIndex >= 0 && items[selectedIndex]) {
      e.preventDefault();
      window.location.href = items[selectedIndex].href;
    } else if (e.key === 'Escape') {
      hideSuggestions();
      this.blur();
    }
  });

  // Click on suggestion
  suggestions.addEventListener('click', function(e) {
    const item = e.target.closest('.search-suggestion-item');
    if (item && item.href) {
      window.location.href = item.href;
    }
  });

});
</script>
